openapi: 3.0.1
info:
  title: API de Banco Challenge
  description: API REST para gestión de clientes, cuentas y movimientos bancarios
  version: "1.0.0"
  contact:
    name: SebasRo17
    url: https://github.com/SebasRo17/Challenge

servers:
  - url: http://localhost:8080/api/v1
    description: Servidor local

tags:
  - name: Clientes
    description: Operaciones de clientes
  - name: Cuentas
    description: Operaciones de cuentas
  - name: Movimientos
    description: Operaciones de movimientos

paths:
  /customers:
    get:
      tags:
        - Clientes
      summary: Listar clientes
      operationId: getAllCustomers
      responses:
        "200":
          description: Lista de clientes
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: "#/components/schemas/CustomerResponse"

    post:
      tags:
        - Clientes
      summary: Crear cliente
      operationId: createCustomer
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/CustomerRequest"
      responses:
        "201":
          description: Cliente creado
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/CustomerResponse"
        "400":
          description: Datos inválidos
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
        "409":
          description: Cliente ya existe
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"

  /customers/{customerId}:
    get:
      tags:
        - Clientes
      summary: Obtener cliente por ID
      operationId: getCustomerById
      parameters:
        - name: customerId
          in: path
          required: true
          schema:
            type: integer
            format: int64
      responses:
        "200":
          description: Cliente encontrado
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/CustomerResponse"
        "404":
          description: Cliente no encontrado
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"

    put:
      tags:
        - Clientes
      summary: Actualizar cliente
      operationId: updateCustomer
      parameters:
        - name: customerId
          in: path
          required: true
          schema:
            type: integer
            format: int64
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/CustomerUpdateRequest"
      responses:
        "200":
          description: Cliente actualizado
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/CustomerResponse"
        "404":
          description: Cliente no encontrado
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"

    delete:
      tags:
        - Clientes
      summary: Eliminar cliente
      operationId: deleteCustomer
      parameters:
        - name: customerId
          in: path
          required: true
          schema:
            type: integer
            format: int64
      responses:
        "204":
          description: Cliente eliminado
        "404":
          description: Cliente no encontrado
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"

  /accounts:
    get:
      tags:
        - Cuentas
      summary: Listar cuentas
      operationId: getAllAccounts
      responses:
        "200":
          description: Lista de cuentas
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: "#/components/schemas/AccountResponse"

    post:
      tags:
        - Cuentas
      summary: Crear cuenta
      operationId: createAccount
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/AccountRequest"
      responses:
        "201":
          description: Cuenta creada
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/AccountResponse"
        "400":
          description: Datos inválidos
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"

  /accounts/{accountNumber}:
    get:
      tags:
        - Cuentas
      summary: Obtener cuenta por número
      operationId: getAccountByNumber
      parameters:
        - name: accountNumber
          in: path
          required: true
          schema:
            type: string
      responses:
        "200":
          description: Cuenta encontrada
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/AccountResponse"
        "404":
          description: Cuenta no encontrada
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"

    put:
      tags:
        - Cuentas
      summary: Actualizar cuenta
      operationId: updateAccount
      parameters:
        - name: accountNumber
          in: path
          required: true
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/AccountUpdateRequest"
      responses:
        "200":
          description: Cuenta actualizada
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/AccountResponse"
        "404":
          description: Cuenta no encontrada
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"

    delete:
      tags:
        - Cuentas
      summary: Eliminar cuenta
      operationId: deleteAccount
      parameters:
        - name: accountNumber
          in: path
          required: true
          schema:
            type: string
      responses:
        "204":
          description: Cuenta eliminada
        "404":
          description: Cuenta no encontrada
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"

  /movements:
    post:
      tags:
        - Movimientos
      summary: Crear movimiento
      operationId: createMovement
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/MovementRequest"
      responses:
        "201":
          description: Movimiento creado
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/MovementResponse"
        "400":
          description: Saldo insuficiente o datos inválidos
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"

  /movements/account/{accountNumber}:
    get:
      tags:
        - Movimientos
      summary: Listar movimientos por cuenta
      operationId: getMovementsByAccount
      parameters:
        - name: accountNumber
          in: path
          required: true
          schema:
            type: string
        - name: startDate
          in: query
          required: false
          schema:
            type: string
            format: date
        - name: endDate
          in: query
          required: false
          schema:
            type: string
            format: date
      responses:
        "200":
          description: Lista de movimientos
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: "#/components/schemas/MovementResponse"
        "404":
          description: Cuenta no encontrada
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"

components:
  schemas:
    CustomerRequest:
      type: object
      required:
        - name
        - identification
        - password
      properties:
        name:
          type: string
          minLength: 3
          maxLength: 100
        gender:
          type: string
          enum: [Masculino, Femenino, Otro]
        address:
          type: string
          maxLength: 200
        phone:
          type: string
          pattern: "^[0-9]{10}$"
        identification:
          type: string
          pattern: '^(\d{10}|\d{13})$'
        password:
          type: string
          pattern: "^[0-9]+$"
          minLength: 4
        status:
          type: boolean
          default: true

    CustomerUpdateRequest:
      type: object
      properties:
        name:
          type: string
          minLength: 3
          maxLength: 100
        address:
          type: string
          maxLength: 200
        phone:
          type: string
          pattern: "^[0-9]{10}$"
        password:
          type: string
          pattern: "^[0-9]+$"
          minLength: 4
        status:
          type: boolean

    CustomerResponse:
      type: object
      properties:
        customerId:
          type: integer
          format: int64
        name:
          type: string
        gender:
          type: string
        address:
          type: string
        phone:
          type: string
        identification:
          type: string
        status:
          type: boolean

    AccountRequest:
      type: object
      required:
        - accountNumber
        - accountType
        - customerId
      properties:
        accountNumber:
          type: string
          pattern: "^[0-9]+$"
        accountType:
          type: string
          enum: [Ahorros, Corriente]
        initialBalance:
          type: number
          format: double
          minimum: 0
          default: 0
        status:
          type: boolean
          default: true
        customerId:
          type: integer
          format: int64

    AccountUpdateRequest:
      type: object
      properties:
        accountType:
          type: string
          enum: [Ahorros, Corriente]
        status:
          type: boolean

    AccountResponse:
      type: object
      properties:
        accountNumber:
          type: string
        accountType:
          type: string
        initialBalance:
          type: number
          format: double
        status:
          type: boolean
        customerId:
          type: integer
          format: int64

    MovementRequest:
      type: object
      required:
        - movementType
        - value
        - accountNumber
      properties:
        movementType:
          type: string
          enum: [Débito, Crédito, Debito, Credito]
        value:
          type: number
          format: double
          minimum: 0.01
        accountNumber:
          type: string

    MovementResponse:
      type: object
      properties:
        movementId:
          type: integer
          format: int64
        date:
          type: string
          format: date
        movementType:
          type: string
        value:
          type: number
          format: double
        balance:
          type: number
          format: double
        accountNumber:
          type: string

    ErrorResponse:
      type: object
      properties:
        error:
          type: string
        mensaje:
          type: string
        timestamp:
          type: string
          format: date-time
  #PARÁMETROS
  parameters:
    CustomerIdParam:
      name: customerId
      in: path
      description: ID del cliente
      required: true
      schema:
        type: integer
        format: int64
        example: 1

    AccountNumberParam:
      name: accountNumber
      in: path
      description: Número unico de cuenta bancaria
      required: true
      schema:
        type: string
        example: "478758"

  #RESPUESTAS COMUNES
  responses:
    BadRequest:
      description: Peticion inválida - datos incorrectos o faltantes
      content:
        application/json:
          schema:
            oneOf:
              - $ref: "#/components/schemas/ErrorResponse"
              - $ref: "#/components/schemas/ValidationErrorResponse"
          examples:
            invalidInput:
              summary: Ejemplo de respuesta de entrada inválida
              value:
                error: "Datos de Entrada Inválidos"
                mensajes:
                  - "name: El campo 'name' debe tener entre 3 y 100 caracteres."
                  - "identifacation: El campo 'identifacation' debe tener 10 o 13 dígitos."
            saldoInsuficiente:
              summary: Ejemplo de respuesta de saldo insuficiente
              value:
                timestamp: "2024-01-15T10:00:00Z"
                status: 400
                error: "Bad Request"
                message: "Saldo insuficiente para realizar el retiro."

    NotFound:
      description: Recurso no encontrado
      content:
        application/json:
          schema:
            $ref: "#/components/schemas/ErrorResponse"
          example:
            timestamp: "2024-01-15T10:00:00Z"
            status: 404
            error: "Not Found"
            message: "Cliente no encontrado con el ID proporcionado."

    Conflict:
      description: Conflicto - recurso ya existe o regla de negocio violada
      content:
        application/json:
          schema:
            $ref: "#/components/schemas/ErrorResponse"
          example:
            identificacionDuplicada:
              summary: Ejemplo de respuesta de identificación duplicada
              value:
                timestamp: "2024-01-15T10:00:00Z"
                status: 409
                error: "Conflict"
                message: "El número de identificación ya existe."
            cuentaDuplicada:
              summary: Ejemplo de respuesta de cuenta duplicada
              value:
                timestamp: "2024-01-15T10:00:00Z"
                status: 409
                error: "Conflict"
                message: "El número de cuenta ya existe."

    InternalServerError:
      description: Error interno del servidor
      content:
        application/json:
          schema:
            $ref: "#/components/schemas/ErrorResponse"
          example:
            timestamp: "2024-01-15T10:00:00Z"
            status: 500
            error: "Internal Server Error"
            message: "Ocurrió un error inesperado en el servidor."
